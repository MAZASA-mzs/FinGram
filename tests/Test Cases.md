# СПЕЦИФИКАЦИЯ ТЕСТ-КЕЙСОВ

**Проект:** Telegram-бот для учёта личных финансов
**Документ:** Test Cases
**Версия:** 1.1
**Статус:** редакция
**Дата:** 21_12_2025
## Цель документа
Настоящий документ содержит перечень тестовых сценариев, разработанных на основании утверждённого тест-плана. Тест-кейсы охватывают все уровни проверки системы: от модульной логики до нагрузочного и сквозного тестирования.

## 1. Функциональное тестирование (Manual & E2E)

| ID         | Название                       | Предусловия                                                                | Шаги                                                          | Ожидаемый результат                                                                                         | Статус   | Комментарий                                   |
| :--------- | :----------------------------- | :------------------------------------------------------------------------- | :------------------------------------------------------------ | :---------------------------------------------------------------------------------------------------------- | :------- | :-------------------------------------------- |
| **TC-F01** | Первичная авторизация (/start) | Аккаунт пользователя внесен в список разрешенных в конфигурационном файле. | 1. Отправить команду `/start`.                                | Система инициализирует профиль, устанавливает категории по умолчанию и отправляет приветственное сообщение. | **Auto** | Реализован в `e2e/test_bot.py`                |
| **TC-F02** | Ограничение доступа            | Аккаунт пользователя отсутствует в списке `allowed_user_ids`.              | 1. Отправить любое сообщение боту.                            | Система возвращает сообщение «⛔ Нет доступа» и прерывает выполнение.                                        | **Auto** | Реализован в `integration/test_middleware.py` |
| **TC-F03** | Управление категориями         | Пользователь успешно авторизован.                                          | 1. Отправить команду `/set_cats Продукты, Транспорт, Аренда`. | Система обновляет список категорий в БД и подтверждает действие сообщением.                                 | Open     | Требует ручной проверки                       |

## 2. Модульное и интеграционное тестирование (Unit)

| ID         | Название                 | Компонент           | Проверка                                                                       | Ожидаемый результат                                                                  | Статус   | Файл                               |
| :--------- | :----------------------- | :------------------ | ------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------ | :------- | :--------------------------------- |
| **TC-U01** | Парсинг дат              | `SberParser`        | Передача строк типа «01 янв 2023», «15.05.2024», «2023-12-31».                 | Модуль корректно преобразует все варианты в объекты `datetime`.                      | **Auto** | `unit/test_sber.py`                |
| **TC-U02** | Очистка JSON             | `YandexGPTProvider` | Передача текста от ИИ, содержащего разметку (markdown блоки) и лишние пробелы. | Регулярное выражение корректно извлекает только валидную JSON-строку.                | **Auto** | `integration/test_llm_provider.py` |
| **TC-U03** | Генерация CSV            | `ReportGenerator`   | Генерация файла на основе списка транзакций.                                   | CSV-файл содержит корректный заголовок и соответствует кодировке UTF-8.              | **Auto** | `unit/test_reports.py`             |
| **TC-U04** | Нулевые суммы            | `SberParser`        | Загрузка строки выписки с суммой 0.00.                                         | Система игнорирует транзакцию или корректно записывает её без математических ошибок. | **Auto** | `unit/test_sber.py`                |
| **TC-U05** | Смещение временного окна | `Processor`         | Заметка создана 1-го числа в 10:00, транзакция 2-го числа в 09:00.             | Система находит связь между событиями благодаря окну в 1 день (`window_days`).       | **Auto** | `integration/test_processor.py`    |


## 3. Тестирование бизнес-логики (BDD Сценарии)
Сценарии BDD тестирования прикреплены в приложении (де факто сценарии прописаны в коде, *прим. редактора*)

## 4. Автоматизированное UI-тестирование (Coded UI)

| ID         | Название                  | Алгоритм автоматизации                                                  | Ожидаемый результат                                                                              | Статус                   |
| :--------- | :------------------------ | ----------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- | :----------------------- |
| **TC-A01** | Навигация по меню         | Эмуляция нажатия/ввода `/settings`. Проверка текстового состава ответа. | Ответ содержит актуальный список категорий и текущие настройки подсказок.                        | **Auto** (`test_bot.py`) |
| **TC-A02** | Некорректный формат файла | Отправка файла `.pdf` или `.doc`.                                       | Бот мгновенно возвращает предупреждение: «❌ Жду файл Excel (.xlsx)». Процесс LLM не запускается. | **Auto** (`test_bot.py`) |

## 5. Нагрузочное тестирование

| ID         | Название               | Описание                                    | Условия нагрузки                                                   | Условия нагрузки                                                                                                                   | Ожидаемый результат                  |
| :--------- | :--------------------- | :------------------------------------------ | ------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| **TC-L01** | Конкурентная обработка | Симуляция 10 одновременных запросов к боту. | Одновременная загрузка 10 объемных выписок разными пользователями. | Система обрабатывает не более 4-х транзакций одновременно (согласно `semaphore`), остальные ожидают в очереди без падения сервиса. | **Auto** (`load_tests/test_load.py`) |
